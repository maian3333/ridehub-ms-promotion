# ===================================================================
# Spring Cloud Consul Config bootstrap configuration for the "dev" profile
# In prod profile, properties will be overwritten by the ones defined in bootstrap-prod.yml
# ===================================================================

spring:
  application:
    name: ms_promotion
  profiles:
    # The commented value for `active` can be replaced with valid Spring profiles to load.
    # Otherwise, it will be filled in by maven when building the JAR file
    # Either way, it can be overridden by `--spring.profiles.active` value passed in the commandline or `-Dspring.profiles.active` set in `JAVA_OPTS`
    active: "@spring.profiles.active@"
  cloud:
    vault:
      uri: https://vault.${DOMAIN}
      token: ${F4_PASSWORD}
      scheme: https
      kv:
        enabled: true
        backend: secret
        application-name: common-kafka
      # Import infrastructure secrets
      configuration:
        infrastructure: secret/infrastructure

    consul:
      enabled: true
      host: consul.${DOMAIN}
      port: 443
      scheme: https

      # TLS configuration
      tls:
        skip-verify: true

      # Consul Config (KV store)
      config:
        enabled: true
        format: YAML
        acl-token: ${F4_PASSWORD}

      # Consul Discovery (service registration/discovery)
      discovery:
        enabled: true
        register: true
        prefer-ip-address: false
        health-check-path: /management/health
        health-check-interval: 10s

        acl-token: ${F4_PASSWORD}


  config:
    import: vault://secret/infrastructure,vault://secret/common-kafka
  docker:
    compose:
      enabled: false
      lifecycle-management: start-only
      file: src/main/docker/mysql.yml

# Disable Consul health indicator to prevent ACL token errors
# The health indicator checks Consul's status API which requires special ACL permissions
management:
  health:
    consul:
      enabled: false
